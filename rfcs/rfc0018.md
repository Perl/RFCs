# RFC - enhanced regex /xx

## Preamble

    Author:  Karl Williamson <khw@cpan.org>
    ID:      KHW-0001
    Status:  Draft

## Abstract

Let programmers improve the readability of regular expression patterns beyond
what is possible now.

## Motivation

Regular expression patterns were designed for concision rather than clarity.

The /x regular expression pattern modifier was created to enable adding
comments and white space to patterns to make them more readable.  It suffers
from not working for bracketed character classes, and silently compiling to
something unintended when the programmer forgets to mark literal white space,
and much worse, literal '#'.  This last silently swallows the rest of the line
that was supposed to be a part of the pattern.

I eventually added /xx to at least allow tabs and blanks inside bracketed
character classes.  This allows a very minor improvement in their readability.
I could not figure out a way to extend this to allow comments and multiple
lines inside such a class without making it even more likely that the pattern
would silently compile to something unintended.  But now, I think this RFC
fixes that.

## Specification

I propose adding a new opt-in feature.  Call it, for now, 'feature
enhanced_re_xx'.  Within its scope, the /xx modifier would change things so
that inside a bracketed character class [...], any vertical space would be
treated as a blank, essentially ignored.  Any unescaped '#' would begin a
comment that ends at the end of the line, much like the existing /x behavior.

However, comments would change to be not entirely opaque.

Curretnly comments end with the pattern delimiter, unescaped.  This feature
would additionaly raise a warning if an unescaped delimiter occurs inside a
comment.  Delimiters would have to be on a separate line.

And comments inside [...] would check for an unescaped ']', and raise a warning
if found.  So, something like

 [ a-z # 0-9 ]

would warn.  Either escape the '#' or the ']' to suppress it, depending on what
your intent was.

I'm also thinking that an unescaped '#' that isn't of the form \s+#\s+ should
warn.

I think these would catch essentially all unintended uses of '#' to mean
not-a-comment, but to be taken literally.

I can't think of anything to catch blanks/tabs being unintentionally ignored.

I also propose that unescaped '#' and vertical space inside bracketed character
classes under /xx be deprecated.  /xx has been available only since 5.26;
there's not a huge amount of code that uses it.  After the deprecation cycle,
the feature could become automatic, not opt-in, and /xx would have the new
meaning.  

Note there is no change to plain /x.

Copyright (C) 2022 Karl Williamson

This document and code and documentation within it may be used, redistributed
and/or modified under the same terms as Perl itself.

